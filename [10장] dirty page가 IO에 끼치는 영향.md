# 10.1 dirty page란

리눅스에서 파일 I/O가 일어날 때 커널은 PageCache를 이용해서 디스크에 있는 파일의 내용을 메모리에 잠시 저장하고, 필요할 때마다 메모리에 접근해서 사용한다. 이를 통해 디스크보다 더 빠른 메모리의 접근 속도를 활용할 수 있고 전체적으로 시스템의 성능을 향상시킬 수 있다.

그림을 보면 각각 a, b, c 파일이 PageCache에 올라가 있으며 1:1로 대응하고 있다. 이 상태에서 b 파일에 쓰기 작업이 이루어졌다고 가정해보자. b 파일의 내용이 b가 아니라 d로 바뀌었으며, 이 상태에서 보면 b 파일의 내용은 디스크와 PageCache에 있는 내용이 서로 다르다. 그래서 **커널은 해당 메모리 영역에 대해 디스크에 있는 내용과 달라졌음을 표시하는 Dirty 비트를 켜고 바로 이 영역은 dirty page라고 부른다.** 즉, dirty page는 **PageCache에 있는 페이지 중에서도 쓰기 작업이 이루어진 메모리**라고 볼 수 있다. 이 상태에서는 아직 PageCache와 디스크 사이의 내용이 다르기 때문에 전원 장애 등으로 시스템이 꺼져 버린다면 미처 디스크에 쓰지 못한 내용은 날아가게 되며 파일의 내용에 대한 정합성이 깨지게 된다. 하지만 dirty page로 표시된 메모리들을 dirty page가 생성될 때마다 디스크에 쓰면 이 또한 상당량의 쓰기 I/O를 일으켜서 성능을 저하시킬 수 있다.

**그래서 커널은 몇 가지 조건을 만들어서 해당 조건을 만족시키면 dirty page를 디스크로 동기화한다. 이 과정을 page writeback이라고 부르며 dirty page 동기화**라고도 한다. 커널 버전에 따라서 다르겠지만 보통 flush라는 단어가 들어간 커널 스레드(pdflush, flush, bdflush 등)가 이 작업을 진행한다. 그래서 **I/O가 많이 발생하는 서버에서는 dirty page를 언제 얼마나 동기화 시키느냐가 중요한 성능 튜닝의 요소**가 된다. 그리고 커널에서는 서버의 워크로드에 따라 가장 적합한 동기화 전략을 구사할 수 있도록 파라미터로 조절할 수 있는 인터페이스를 제공하고 있다.